!function(a,b){"use strict";function d(a){var b;this.defaults={formID:"crystal-form",ajaxSubmit:!1,fields:{}},this.config=d.augment({},this.defaults,a||{}),b=function(){var a=this.ajaxSubmitForm.bind(this),b=this.standardSubmitForm.bind(this);this.config.ajaxSubmit?a():b()}.bind(this)()}function f(a){var b;this.defaults={fieldID:"",domOBJ:null,commonName:this.fieldID,regex:null,lastState:!1,timesActive:0,trigger:"oninput"},this.config=f.augment({},this.defaults,a||{}),"oninput"!==this.config.trigger&&"onblur"!==this.config.trigger&&(this.config.trigger=this.defaults.trigger),b=function(a,b){this.config.domOBJ=this.setDomOBJ(b),this.config.domOBJ[a]=this.isValid.bind(this)}.bind(this)(this.config.trigger,this.config.fieldID)}function g(a){return h(arguments,function(b){b!==a&&h(b,function(b,c){a[c]=b})}),a}function h(a,b,c){var d;if(a)if("undefined"!=typeof a.length){for(d=0;d<a.length;d++)if(b.call(c,a[d],d)===!1)return}else for(d in a)if(a.hasOwnProperty(d)&&b.call(c,a[d],d)===!1)return}d.prototype={addField:function(a){var b=new f(a);this.config.fields[b.config.commonName]=b},style:function(a){var c=b.querySelectorAll(".crystal-alert-success"),d=b.querySelectorAll(".crystal-alert-invalid"),e=b.querySelectorAll(".crystal-invalid"),f=b.querySelectorAll(".crystal-required");if(a){for(var g=0;g<e.length;g++)e[g].className.replace(/(?:^|\s)invalid(?!\S)/g,"");for(var g=0;g<d.length;g++)d[g].style.display="none";for(var g=0;g<c.length;g++)c[g].style.display="block"}else{for(var g=0;g<d.length;g++)d[g].style.display="block";for(var g=0;g<f.length;g++)f[g].className+=" crystal-invalid"}},ajaxSubmitForm:function(){b.getElementById(this.config.formID).addEventListener("submit",function(a){var c,d,e;a.preventDefault(),c=!0;for(var f in this.config.fields)this.config.fields[f].config.lastState===!1&&(c=!1);c===!0?(d=serialize(b.getElementById(this.config.formID)),e=new XMLHttpRequest,e.open("POST","/",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&this.style(!0)}.bind(this),e.send(d)):this.style(!1)}.bind(this))},standardSubmitForm:function(){b.getElementById(this.config.formID).addEventListener("submit",function(a){var b;a.preventDefault(),b=!0;for(var c in this.config.fields)this.config.fields[c].lastState===!1&&(b=!1)}.bind(this)),valid?e.submit():this.style(!0)}},f.prototype={setDomOBJ:function(a){return b.getElementById(a)},isValid:function(){return this.config.regex.test(this.config.domOBJ.value)?(this.config.domOBJ.className=this.config.domOBJ.className.replace(/(?:^|\s)crystal-invalid(?!\S)/g,""),this.config.lastState=!0,!0):(this.config.domOBJ.className+=" crystal-invalid",this.config.lastState=!1,!1)}},d.augment=g,f.augment=g,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=d:(a.Crystal=d,"function"==typeof define&&define.amd&&define("crystal",[],function(){return d}))}(window,document);